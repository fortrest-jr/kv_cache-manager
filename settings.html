<div class="kv-cache-manager-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>KV Cache Manager</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div class="kv-cache-manager-section">
                <h3>Управление кешем</h3>
                <div class="kv-cache-manager-field">
                    <p><strong>Активные слоты для сохранения:</strong></p>
                    <div id="kv-cache-slots-list" class="kv-cache-manager-info">
                        <p>Загрузка...</p>
                    </div>
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <input id="kv-cache-save-now-button" class="menu_button" type="submit" value="Сохранить сейчас" />
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <input id="kv-cache-save-button" class="menu_button" type="submit" value="Сохранить с именем" />
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <input id="kv-cache-load-button" class="menu_button" type="submit" value="Загрузить кеш" />
                </div>
            </div>

            <hr class="sysHR" />

            <div class="kv-cache-manager-section">
                <h3>Статистика и последнее сохранение</h3>
                <div id="kv-cache-last-save" class="kv-cache-manager-info">
                    <p><strong>Последнее сохранение:</strong></p>
                    <p id="kv-cache-last-save-info">Нет данных</p>
                </div>
                <div id="kv-cache-statistics" class="kv-cache-manager-info">
                    <p><strong>Статистика:</strong></p>
                    <p id="kv-cache-stats-info">Нет данных</p>
                </div>
            </div>

            <hr class="sysHR" />

            <div class="kv-cache-manager-section">
                <h3>Дополнительные настройки</h3>
                <div class="kv-cache-manager-field flex-container">
                    <input type="checkbox" id="kv-cache-auto-load" />
                    <label for="kv-cache-auto-load">Автозагрузка при переключении на чат</label>
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <input type="checkbox" id="kv-cache-show-notifications" />
                    <label for="kv-cache-show-notifications">Показывать уведомления</label>
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <input type="checkbox" id="kv-cache-validate" />
                    <label for="kv-cache-validate">Проверять валидность кеша</label>
                </div>
            </div>

            <hr class="sysHR" />

            <div class="kv-cache-manager-section">
                <h3>Автоматическое сохранение</h3>
                <div class="kv-cache-manager-field flex-container">
                    <input type="checkbox" id="kv-cache-enabled" />
                    <label for="kv-cache-enabled">Включить автосохранение</label>
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <label for="kv-cache-save-interval">Сохранять каждые N сообщений:</label>
                    <input type="number" id="kv-cache-save-interval" min="1" value="5" />
                </div>
                <div class="kv-cache-manager-field flex-container">
                    <label for="kv-cache-max-files">Максимум файлов на сессию:</label>
                    <input type="number" id="kv-cache-max-files" min="1" value="10" />
                </div>
                <div class="kv-cache-manager-field">
                    <span id="kv-cache-next-save">Следующее сохранение через: - сообщений</span>
                </div>
            </div>

            <hr class="sysHR" />
        </div>
    </div>
</div>

<!-- Модалка загрузки кеша -->
<div id="kv-cache-load-modal" class="dialogue_popup" style="display: none;">
    <div class="dialogue_popup_content" style="max-width: 90vw; width: 1000px; max-height: 90vh;">
        <div class="dialogue_popup_header">
            <h3>Загрузка кеша</h3>
            <button class="dialogue_popup_close" id="kv-cache-load-modal-close">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="dialogue_popup_body" style="display: flex; flex-direction: column; height: calc(90vh - 100px);">
            <!-- Поиск -->
            <div class="kv-cache-load-search" style="margin-bottom: 10px;">
                <input type="text" id="kv-cache-load-search-input" placeholder="Поиск по чату или имени..." 
                       style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--SmartThemeBorderColor); background: var(--SmartThemeBlurTintColor); color: var(--SmartThemeBodyColor);" />
            </div>
            
            <div class="kv-cache-load-content" style="display: flex; flex: 1; gap: 15px; overflow: hidden; flex-direction: row;">
                <!-- Боковая панель с чатами -->
                <div class="kv-cache-load-chats" style="width: 250px; border-right: 1px solid var(--SmartThemeBorderColor); overflow-y: auto; padding-right: 10px;">
                    <div class="kv-cache-load-chat-item kv-cache-load-chat-item-current" data-chat-id="current">
                        <div class="kv-cache-load-chat-name">
                            <i class="fa-solid fa-comments" style="margin-right: 5px;"></i>
                            Текущий чат
                        </div>
                        <div class="kv-cache-load-chat-count">-</div>
                    </div>
                    <div id="kv-cache-load-chats-list"></div>
                </div>
                
                <!-- Основная область с файлами -->
                <div class="kv-cache-load-files" style="flex: 1; overflow-y: auto;">
                    <div id="kv-cache-load-files-list" style="display: flex; flex-direction: column; gap: 10px;">
                        <p style="text-align: center; color: var(--SmartThemeBodyColor); padding: 20px;">
                            Выберите чат для просмотра файлов
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Кнопки действий -->
            <div class="dialogue_popup_footer" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--SmartThemeBorderColor); display: flex; justify-content: space-between; align-items: center;">
                <div id="kv-cache-load-selected-info" style="color: var(--SmartThemeBodyColor);">
                    Файл не выбран
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="kv-cache-load-cancel-button" class="menu_button">Отмена</button>
                    <button id="kv-cache-load-confirm-button" class="menu_button" disabled>Загрузить</button>
                </div>
            </div>
        </div>
    </div>
</div>
